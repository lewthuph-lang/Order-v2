<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Order App PWA</title>
  
  <!-- PWA: Apple Mobile Web App Capable -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Order App">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3075/3075977.png">

  <!-- PWA: Embedded Manifest -->
  <link rel="manifest" id="manifest-placeholder">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body { -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .fade-in { animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* PWA Safe Area for iPhone X+ */
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
  </style>

  <script>
    // Generate Manifest dynamically to work in single-file setup
    const manifest = {
      "name": "Order App Pro",
      "short_name": "OrderApp",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#f8fafc",
      "theme_color": "#2563eb",
      "orientation": "portrait",
      "icons": [
        {
          "src": "https://cdn-icons-png.flaticon.com/512/3075/3075977.png",
          "sizes": "512x512",
          "type": "image/png"
        }
      ]
    };
    const stringManifest = JSON.stringify(manifest);
    const blob = new Blob([stringManifest], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(blob);
    document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
  </script>
</head>
<body class="h-full flex flex-col text-slate-800 overflow-hidden">

  <div id="root" class="flex flex-col h-full w-full"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- API HELPER ---
    const useGoogleSheets = () => {
      const [apiUrl, setApiUrl] = useState(localStorage.getItem('gas_api_url') || "");
      const [loading, setLoading] = useState(false);

      const saveUrl = (url) => {
        setApiUrl(url);
        localStorage.setItem('gas_api_url', url);
      };

      const request = async (action, method = 'GET', body = null) => {
        if (!apiUrl) return null;
        setLoading(true);
        try {
          let url = `${apiUrl}?action=${action}`;
          let options = { method };
          
          if (method === 'POST') {
            options.body = JSON.stringify({ action, ...body });
          }

          const res = await fetch(url, options);
          const json = await res.json();
          setLoading(false);
          return json;
        } catch (err) {
          console.error(err);
          setLoading(false);
          alert("Connection Error. Check your Internet or API URL.");
          return null;
        }
      };

      return { apiUrl, saveUrl, request, loading };
    };

    // --- PWA INSTALL HOOK ---
    const usePWAInstall = () => {
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [isInstalled, setIsInstalled] = useState(false);

      useEffect(() => {
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          setDeferredPrompt(e);
        });

        if (window.matchMedia('(display-mode: standalone)').matches) {
          setIsInstalled(true);
        }
      }, []);

      const installApp = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          setDeferredPrompt(null);
        }
      };

      return { deferredPrompt, installApp, isInstalled };
    };

    // --- Components ---

    const Icon = ({ name, size = 20, className = "" }) => {
      useEffect(() => {
        if(window.lucide) window.lucide.createIcons();
      }, [name]);
      return <i data-lucide={name} width={size} height={size} className={className}></i>;
    };

    // --- Main App ---
    function App() {
      const { apiUrl, saveUrl, request, loading } = useGoogleSheets();
      const { deferredPrompt, installApp } = usePWAInstall();
      const [activeTab, setActiveTab] = useState('orders'); 
      const [showConfig, setShowConfig] = useState(!apiUrl);
      
      const [menuItems, setMenuItems] = useState([]);
      const [roster, setRoster] = useState([]); 
      const [history, setHistory] = useState([]);
      
      const [currentOrders, setCurrentOrders] = useState(() => {
        const saved = localStorage.getItem('local_session_orders');
        return saved ? JSON.parse(saved) : [];
      });

      useEffect(() => {
        localStorage.setItem('local_session_orders', JSON.stringify(currentOrders));
      }, [currentOrders]);

      useEffect(() => {
        if (apiUrl) refreshData();
      }, [apiUrl]);

      const refreshData = async () => {
        const [menuData, peopleData, historyData] = await Promise.all([
          request('getMenu'),
          request('getPeople'),
          request('getHistory')
        ]);
        
        if (menuData) setMenuItems(menuData.sort((a,b) => a.name.localeCompare(b.name)));
        if (peopleData) setRoster(peopleData.sort((a,b) => a.name.localeCompare(b.name)));
        if (historyData) setHistory(historyData);
      };

      const renderContent = () => {
        if (!apiUrl || showConfig) return <ConfigScreen currentUrl={apiUrl} onSave={(url) => { saveUrl(url); setShowConfig(false); }} />;
        
        switch(activeTab) {
          case 'orders': return <OrdersView 
            menuItems={menuItems} 
            roster={roster} 
            currentOrders={currentOrders} 
            setCurrentOrders={setCurrentOrders} 
            request={request}
            refreshData={refreshData}
          />;
          case 'people': return <PeopleTab roster={roster} request={request} refreshData={refreshData} />;
          case 'menu': return <MenuTab menuItems={menuItems} request={request} refreshData={refreshData} />;
          case 'history': return <HistoryTab history={history} request={request} refreshData={refreshData} />;
          default: return null;
        }
      };

      return (
        <div className="flex flex-col md:flex-row h-full bg-slate-100">
          
          {/* Sidebar (Desktop) */}
          <div className="hidden md:flex flex-col w-64 bg-slate-900 text-white shadow-xl z-20 pt-safe">
            <div className="p-6">
              <h1 className="text-2xl font-bold flex items-center gap-2">
                <span className="bg-blue-600 p-1.5 rounded-lg"><Icon name="utensils" size={24} /></span>
                Order App
              </h1>
            </div>
            <nav className="flex-1 px-4 space-y-2">
              <NavButton active={activeTab==='orders'} onClick={()=>setActiveTab('orders')} icon="shopping-cart" label="Take Orders" />
              <NavButton active={activeTab==='people'} onClick={()=>setActiveTab('people')} icon="users" label="Manage People" />
              <NavButton active={activeTab==='menu'} onClick={()=>setActiveTab('menu')} icon="menu" label="Manage Menu" />
              <NavButton active={activeTab==='history'} onClick={()=>setActiveTab('history')} icon="history" label="Order History" />
            </nav>
            <div className="p-4 border-t border-slate-800 space-y-2">
               {deferredPrompt && (
                  <button onClick={installApp} className="w-full flex items-center gap-2 px-3 py-2 bg-blue-600 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                    <Icon name="download" size={16} /> Install App
                  </button>
               )}
               <button onClick={()=>setShowConfig(true)} className="flex items-center gap-2 text-xs text-slate-400 hover:text-white px-2">
                 <Icon name="settings" size={14} /> Connection Settings
               </button>
            </div>
          </div>

          {/* Mobile Layout */}
          <div className="flex-1 flex flex-col h-full overflow-hidden relative">
            
            {/* Header */}
            <div className="md:hidden bg-white shadow-sm p-4 pt-safe flex justify-between items-center z-10">
              <h1 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                 <Icon name="utensils" className="text-blue-600" /> Order App
              </h1>
              <div className="flex items-center gap-3">
                {loading && <div className="loader"></div>}
                
                {deferredPrompt && (
                  <button onClick={installApp} className="text-blue-600 animate-pulse" title="Install App">
                    <Icon name="download" size={22} />
                  </button>
                )}
                
                <button onClick={()=>setShowConfig(true)} className="text-slate-400">
                  <Icon name="settings" size={22} />
                </button>
              </div>
            </div>

            {/* Content */}
            <main className="flex-1 overflow-y-auto overflow-x-hidden relative bg-slate-50">
              {renderContent()}
            </main>

            {/* Bottom Nav */}
            {!showConfig && (
              <div className="md:hidden bg-white border-t border-slate-200 flex justify-around p-2 pb-safe z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                <MobileNavBtn active={activeTab==='orders'} onClick={()=>setActiveTab('orders')} icon="shopping-cart" label="Orders" />
                <MobileNavBtn active={activeTab==='people'} onClick={()=>setActiveTab('people')} icon="users" label="People" />
                <MobileNavBtn active={activeTab==='menu'} onClick={()=>setActiveTab('menu')} icon="menu" label="Menu" />
                <MobileNavBtn active={activeTab==='history'} onClick={()=>setActiveTab('history')} icon="history" label="History" />
              </div>
            )}
          </div>
        </div>
      );
    }

    // --- Config Screen ---
    const ConfigScreen = ({ currentUrl, onSave }) => {
      const [url, setUrl] = useState(currentUrl);

      return (
        <div className="p-8 max-w-lg mx-auto mt-10">
          <div className="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
            <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
              <Icon name="database" className="text-blue-600"/> Connect Google Sheet
            </h2>
            <p className="text-sm text-slate-500 mb-4">
              Enter the <strong>Web App URL</strong> from your Google Apps Script deployment.
            </p>
            <input 
              className="w-full bg-slate-50 border border-slate-300 rounded-lg px-4 py-3 mb-4 text-sm break-all focus:ring-2 focus:ring-blue-500 outline-none"
              placeholder="https://script.google.com/macros/s/..."
              value={url}
              onChange={e => setUrl(e.target.value)}
            />
            <button 
              onClick={() => onSave(url)}
              className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition-colors"
            >
              Connect & Save
            </button>
            <div className="mt-6 text-xs text-slate-400 bg-slate-50 p-3 rounded border border-slate-100">
              <strong>Tip:</strong> Ensure your Script is deployed as "Web App" and access is set to "Anyone".
            </div>
          </div>
        </div>
      );
    };

    // --- Sub Components ---
    const NavButton = ({ active, onClick, icon, label }) => (
      <button onClick={onClick} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${active ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
        <Icon name={icon} size={20} />
        <span className="font-medium">{label}</span>
      </button>
    );

    const MobileNavBtn = ({ active, onClick, icon, label }) => (
      <button onClick={onClick} className={`flex flex-col items-center justify-center w-full py-1 ${active ? 'text-blue-600' : 'text-slate-400'}`}>
        <div className={`p-1 rounded-full mb-1 ${active ? 'bg-blue-50' : ''}`}>
          <Icon name={icon} size={24} />
        </div>
        <span className="text-[10px] font-medium">{label}</span>
      </button>
    );

    const OrdersView = ({ menuItems, roster, currentOrders, setCurrentOrders, request, refreshData }) => {
      const [showPersonSelect, setShowPersonSelect] = useState(false);
      const [showSummary, setShowSummary] = useState(false);
      const [orderNote, setOrderNote] = useState("");
      const summaryRef = useRef(null);

      const addToSession = (rosterPerson) => {
        if (currentOrders.find(o => o.personId === rosterPerson.id)) return alert("Already added!");
        setCurrentOrders([...currentOrders, { personId: rosterPerson.id, personName: rosterPerson.name, orders: {} }]);
        setShowPersonSelect(false);
      };

      const addGuest = () => {
        const guestId = `guest-${Date.now()}`;
        setCurrentOrders([...currentOrders, {
          personId: guestId,
          personName: `Guest ${currentOrders.filter(o=>o.personId.startsWith('guest')).length + 1}`,
          orders: {}
        }]);
        setShowPersonSelect(false);
      };

      const updateOrderQty = (personId, itemId, delta) => {
        setCurrentOrders(currentOrders.map(p => {
          if (p.personId !== personId) return p;
          const currentQty = p.orders[itemId] || 0;
          const newQty = Math.max(0, currentQty + delta);
          const newOrders = { ...p.orders };
          if (newQty === 0) delete newOrders[itemId];
          else newOrders[itemId] = newQty;
          return { ...p, orders: newOrders };
        }));
      };

      const calculateTotal = (orders) => {
        return Object.entries(orders).reduce((sum, [itemId, qty]) => {
          const item = menuItems.find(i => i.id == itemId);
          return sum + (item ? item.price * qty : 0);
        }, 0);
      };

      const grandTotal = currentOrders.reduce((acc, p) => acc + calculateTotal(p.orders), 0);

      const handleFinalize = async () => {
        if(!summaryRef.current) return;
        const canvas = await html2canvas(summaryRef.current, { scale: 2, backgroundColor: "#ffffff" });
        const link = document.createElement('a');
        link.download = `Order-${new Date().toISOString().slice(0,10)}.png`;
        link.href = canvas.toDataURL();
        link.click();

        const orderData = {
          total: grandTotal,
          note: orderNote,
          peopleCount: currentOrders.length,
          details: currentOrders.map(p => ({
            name: p.personName,
            orders: p.orders
          }))
        };

        const res = await request('saveOrder', 'POST', { data: orderData });
        if (res && res.status === 'success') {
          if(confirm("Order saved to Sheets! Clear session?")) {
            setCurrentOrders([]);
            setOrderNote("");
            setShowSummary(false);
            refreshData(); 
          }
        }
      };

      return (
        <div className="p-4 space-y-6 pb-24">
          <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
            <button onClick={() => setShowPersonSelect(true)} className="flex-none bg-blue-600 text-white px-4 py-3 rounded-xl shadow-lg shadow-blue-200 flex items-center gap-2 active:scale-95 transition-transform">
              <Icon name="user-plus" /> Add Customer
            </button>
            {currentOrders.length > 0 && (
              <button onClick={() => setShowSummary(true)} className="flex-none bg-emerald-600 text-white px-4 py-3 rounded-xl shadow-lg shadow-emerald-200 flex items-center gap-2 active:scale-95 transition-transform">
                <Icon name="check-circle" /> Finalize (MVR {grandTotal})
              </button>
            )}
          </div>

          {currentOrders.length === 0 ? (
            <div className="text-center py-20 text-slate-400 bg-white rounded-2xl border-2 border-dashed border-slate-200">
              <Icon name="clipboard" size={48} className="mx-auto mb-4 opacity-50" />
              <p className="text-lg">No active orders</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
              {currentOrders.map(p => (
                <div key={p.personId} className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden fade-in">
                  <div className="bg-slate-50 p-3 flex justify-between items-center border-b border-slate-100">
                    <h3 className="font-bold text-slate-700">{p.personName}</h3>
                    <div className="flex items-center gap-2">
                       <span className="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">MVR {calculateTotal(p.orders)}</span>
                       <button onClick={() => setCurrentOrders(currentOrders.filter(o => o.personId !== p.personId))} className="text-slate-400 hover:text-red-500"><Icon name="x" size={18} /></button>
                    </div>
                  </div>
                  <div className="p-3">
                    <div className="mb-4 space-y-1">
                      {Object.entries(p.orders).map(([itemId, qty]) => {
                        const item = menuItems.find(i => i.id == itemId);
                        if(!item) return null;
                        return (
                          <div key={itemId} className="flex justify-between items-center text-sm bg-blue-50/50 p-2 rounded-lg">
                            <span className="font-medium text-slate-700">{item.name}</span>
                            <div className="flex items-center gap-3">
                              <button onClick={() => updateOrderQty(p.personId, itemId, -1)} className="p-1 bg-white shadow rounded text-red-500"><Icon name="minus" size={12}/></button>
                              <span className="w-4 text-center font-bold">{qty}</span>
                              <button onClick={() => updateOrderQty(p.personId, itemId, 1)} className="p-1 bg-white shadow rounded text-emerald-600"><Icon name="plus" size={12}/></button>
                            </div>
                          </div>
                        )
                      })}
                    </div>
                    <p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Add Items</p>
                    <div className="flex flex-wrap gap-2">
                      {menuItems.map(item => (
                        <button key={item.id} onClick={() => updateOrderQty(p.personId, item.id, 1)} className="flex items-center gap-1 bg-white border border-slate-200 px-3 py-2 rounded-lg text-sm hover:border-blue-400 active:bg-blue-50 transition-colors">
                          <span>{item.name}</span>
                          <span className="text-slate-400 text-xs ml-1">{item.price}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}

          {showPersonSelect && (
            <div className="fixed inset-0 bg-slate-900/50 z-50 flex items-end md:items-center justify-center p-4 backdrop-blur-sm">
              <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
                <div className="p-4 border-b flex justify-between">
                  <h3 className="font-bold">Select Customer</h3>
                  <button onClick={()=>setShowPersonSelect(false)}><Icon name="x"/></button>
                </div>
                <div className="p-2 max-h-[60vh] overflow-y-auto">
                   <button onClick={addGuest} className="w-full text-left p-3 hover:bg-slate-50 rounded-xl text-blue-600 font-medium">Guest (One-time)</button>
                   {roster.map(person => (
                     <button key={person.id} onClick={() => addToSession(person)} className="w-full text-left p-3 hover:bg-slate-50 rounded-xl border-b border-slate-50 block">{person.name}</button>
                   ))}
                </div>
              </div>
            </div>
          )}

          {showSummary && (
             <div className="fixed inset-0 bg-slate-900/80 z-50 flex items-center justify-center p-4 backdrop-blur-md overflow-y-auto">
               <div className="bg-white w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh]">
                 <div className="p-4 border-b flex justify-between"><h2 className="font-bold">Finalize</h2><button onClick={()=>setShowSummary(false)}><Icon name="x"/></button></div>
                 <div className="overflow-y-auto p-6 bg-slate-50">
                    <div ref={summaryRef} className="bg-white p-8 rounded-xl shadow-sm border border-slate-200 mx-auto max-w-lg">
                      <div className="text-center mb-6"><h1 className="text-2xl font-bold uppercase">Receipt</h1><p>{new Date().toLocaleDateString()}</p></div>
                      {currentOrders.map(p => (
                        <div key={p.personId} className="border-b border-dashed pb-2 mb-2">
                           <div className="flex justify-between font-bold"><span>{p.personName}</span><span>{calculateTotal(p.orders)}</span></div>
                           {Object.entries(p.orders).map(([id, q]) => (
                             <div key={id} className="flex justify-between text-sm text-slate-500">
                               <span>{menuItems.find(i=>i.id==id)?.name} x{q}</span>
                               <span>{(menuItems.find(i=>i.id==id)?.price * q).toFixed(2)}</span>
                             </div>
                           ))}
                        </div>
                      ))}
                      <div className="mt-4 pt-4 border-t-2 border-slate-800 flex justify-between font-bold text-xl"><span>Total</span><span>{grandTotal}</span></div>
                    </div>
                    <div className="mt-4"><input className="w-full border p-2 rounded" placeholder="Add Note" value={orderNote} onChange={e=>setOrderNote(e.target.value)}/></div>
                 </div>
                 <div className="p-4 bg-white border-t flex justify-end gap-2">
                    <button onClick={handleFinalize} className="bg-emerald-600 text-white px-6 py-2 rounded-lg flex gap-2"><Icon name="save"/> Save & Download</button>
                 </div>
               </div>
             </div>
          )}
        </div>
      );
    };

    const PeopleTab = ({ roster, request, refreshData }) => {
      const [name, setName] = useState("");
      const [loading, setLoading] = useState(false);

      const add = async (e) => {
        e.preventDefault();
        if(!name) return;
        setLoading(true);
        await request('addPerson', 'POST', { name });
        setName("");
        setLoading(false);
        refreshData();
      };

      const remove = async (id) => {
        if(!confirm("Remove?")) return;
        setLoading(true);
        await request('deletePerson', 'POST', { id });
        setLoading(false);
        refreshData();
      };

      return (
         <div className="p-4 max-w-2xl mx-auto">
            <div className="bg-white p-6 rounded-2xl shadow-sm mb-6">
              <h2 className="font-bold mb-4">Manage Roster</h2>
              <form onSubmit={add} className="flex gap-2">
                <input value={name} onChange={e=>setName(e.target.value)} className="flex-1 border rounded-xl px-4 py-2" placeholder="Name"/>
                <button disabled={loading} className="bg-blue-600 text-white px-6 py-2 rounded-xl">{loading ? '...' : 'Add'}</button>
              </form>
            </div>
            <div className="space-y-2">
              {roster.map(p => (
                <div key={p.id} className="bg-white p-4 rounded-xl shadow-sm flex justify-between">
                   <span>{p.name}</span>
                   <button onClick={()=>remove(p.id)} className="text-red-500"><Icon name="trash-2" size={18}/></button>
                </div>
              ))}
            </div>
         </div>
      );
    };

    const MenuTab = ({ menuItems, request, refreshData }) => {
      const [form, setForm] = useState({ name: "", price: "" });
      const [loading, setLoading] = useState(false);

      const add = async (e) => {
        e.preventDefault();
        if(!form.name || !form.price) return;
        setLoading(true);
        await request('addMenuItem', 'POST', form);
        setForm({ name: "", price: "" });
        setLoading(false);
        refreshData();
      };

      const remove = async (id) => {
        if(!confirm("Remove?")) return;
        setLoading(true);
        await request('deleteMenuItem', 'POST', { id });
        setLoading(false);
        refreshData();
      };

      return (
         <div className="p-4 max-w-2xl mx-auto">
            <div className="bg-white p-6 rounded-2xl shadow-sm mb-6">
              <h2 className="font-bold mb-4">Manage Menu</h2>
              <form onSubmit={add} className="flex gap-2">
                <input value={form.name} onChange={e=>setForm({...form, name: e.target.value})} className="flex-1 border rounded-xl px-4 py-2" placeholder="Item Name"/>
                <input type="number" value={form.price} onChange={e=>setForm({...form, price: e.target.value})} className="w-24 border rounded-xl px-4 py-2" placeholder="Price"/>
                <button disabled={loading} className="bg-blue-600 text-white px-4 py-2 rounded-xl"><Icon name="plus"/></button>
              </form>
            </div>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
              {menuItems.map(i => (
                <div key={i.id} className="bg-white p-3 rounded-xl shadow-sm flex justify-between border">
                   <div><div className="font-medium">{i.name}</div><div className="text-xs text-gray-400">MVR {i.price}</div></div>
                   <button onClick={()=>remove(i.id)} className="text-red-500"><Icon name="trash-2" size={16}/></button>
                </div>
              ))}
            </div>
         </div>
      );
    };

    const HistoryTab = ({ history, request, refreshData }) => (
       <div className="p-4 max-w-3xl mx-auto">
          <div className="flex justify-between items-center mb-6">
             <h2 className="text-xl font-bold flex items-center gap-2"><Icon name="history"/> History</h2>
             <button onClick={refreshData} className="text-blue-600 text-sm">Refresh</button>
          </div>
          <div className="space-y-4">
             {history.map(h => (
               <div key={h.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                  <div className="flex justify-between font-bold mb-1">
                     <span>MVR {h.total}</span>
                     <span className="text-xs text-gray-500 font-normal">{new Date(h.timestamp).toLocaleString()}</span>
                  </div>
                  <div className="text-sm text-gray-600">{h.note || "No note"} â€¢ {h.peopleCount} People</div>
               </div>
             ))}
             {history.length === 0 && <p className="text-center text-gray-400">No history found.</p>}
          </div>
       </div>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>